<div ng-init="obtenerEstados(); obtenerMunicipiosOrigen(1); obtenerMunicipiosDestino(1);">
    <h2>Reportar Animal en Carretera</h2>
    <hr />
    <div id="foto" ng-hide="true">sin foto</div>
    <div class="row">
        <div class="alert alert-danger fade in retro" ng-show="errores">{{mensaje}}</div>
        <div class="alert alert-success fade in retro" ng-show="exito">{{mensaje}}</div>
    </div>
    <div class="row">
        <div class="col-sm-6">
            <h3>Incidente</h3>
            <div class="form-group">
                <div class="archivo btn btn-default">
                    <span><i class="fa fa-camera fa-2x"></i></span>
                    <input type="file" id="imagen" onchange="encodeImageFileAsURL()" class="upload"/>
                </div>
                <label for="imagen">Seleccionar Imagen</label>
            </div>
            <div class="form-group">
                <label for="fecha">Fecha</label> <i class="fa fa-info-circle" title="Fecha en la que sucedi칩 el incidente"></i>
                <input class="form-control"  id="fecha" type="date" ng-model="fecha"/>
            </div>
        </div>
        <div class="col-sm-3 col-sm-offset-1" id="vistaPrevia">
            <img src="/img/vistaPrevia.png" width="100%" title="Vista Previa">
        </div>
    </div>
    <hr/>
    <div class="row">
        <div class="col-sm-12">
            <h3>Origen <span class="info"><i class="fa fa-info-circle" title="Municipio m치s cercano al incidente"></i></span></h3>
        </div>
        <div class="col-sm-6">
            <div class="form-group">
                <label>Estado</label>
                <select class="form-control" ng-model="ruta.origen.idEstado" ng-options="estado.id_estado as estado.estado for estado in estados" ng-change="obtenerMunicipiosOrigen(); limpiarMapa()"></select>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="form-group">
                <label>Municipio</label>
                <select class="form-control" ng-model="ruta.origen.nombreMunicipio" ng-options="municipio.nombre_municipio as municipio.nombre_municipio for municipio in municipiosOrigen" ng-change="calcRuta()"></select>
            </div>
        </div>
    </div>
    <hr/>
    <div class="row">
        <div class="col-sm-12">
            <h3>Destino <span class="info"><i class="fa fa-info-circle" title="Municipio m치s cercano al incidente"></i></span></h3>
        <div>
        <div class="col-sm-6">
            <div class="form-group">
                <label>Estado</label>
                <select class="form-control" ng-model="ruta.destino.idEstado" ng-options="estado.id_estado as estado.estado for estado in estados" ng-change="obtenerMunicipiosDestino(); limpiarMapa()"></select>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="form-group">
                <label>Municipio</label>
                <select class="form-control" ng-model="ruta.destino.nombreMunicipio" ng-options="municipio.nombre_municipio as municipio.nombre_municipio for municipio in municipiosDestino" ng-change="calcRuta()"></select>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
        <label>Selecciona la ubicaci칩n del incidente</label>
        </div>
    </div>
    <div style="display:block; height:600px; width:100%;" id="map-canvas"></div>
    <br>
    <div id="" class="row">
        <div id="" class="col-xs-12">
            <button class="col-xs-4 col-xs-offset-4  btn btn-success" ng-click="agregarIncidente()">Enviar</button>
        </div>
    </div>
<br>
</div>
<script async defer src="https://maps.googleapis.com/maps/api/js?v=3.exp&callback=initMap">
</script>
<script type='text/javascript'>
function encodeImageFileAsURL(){
    var filesSelected = document.getElementById("imagen").files;
    if (filesSelected.length > 0)
    {
        var fileToLoad = filesSelected[0];

        var fileReader = new FileReader();

        fileReader.onload = function(fileLoadedEvent) {
            var srcData = fileLoadedEvent.target.result; // <--- data: base64

            var newImage = document.createElement('img');
            newImage.src = srcData;
            newImage.setAttribute('width', '100%');

            document.getElementById("foto").innerHTML = srcData;
            document.getElementById("vistaPrevia").innerHTML = newImage.outerHTML;
        }
        fileReader.readAsDataURL(fileToLoad);
    }
}
</script>